// Generated by CoffeeScript 1.9.3

/*
 * Bones Scripts File
 * Author: Eddie Machado
 *
 * This file should contain any js scripts you want to add to the site.
 * Instead of calling it in the header or throwing it inside wp_head()
 * this file will be called automatically in the footer so as not to
 * slow the page load.
 *
 * There are a lot of example functions and tools in here. If you don't
 * need any of it, just remove it. They are meant to be helpers and are
 * not required. It's your world baby, you can do whatever you want.
 */


/*
SKROLLR
モバイルでは難しい。。。
 */


/*
 * Get Viewport Dimensions
 * returns object with viewport dimensions to match css in width and height properties
 * ( source: http://andylangton.co.uk/blog/development/get-viewport-size-width-and-height-javascript )
 */

(function() {
  var footerOffsetY, updateViewportDimensions, viewport;

  updateViewportDimensions = function() {
    var d, e, g, w, x, y;
    w = window;
    d = document;
    e = d.documentElement;
    g = d.getElementsByTagName('body')[0];
    x = w.innerWidth || e.clientWidth || g.clientWidth;
    y = w.innerHeight || e.clientHeight || g.clientHeight;
    return {
      width: x,
      height: y
    };
  };

  viewport = updateViewportDimensions();


  /*
   * Throttle Resize-triggered Events
   * Wrap your actions in this function to throttle the frequency of firing them off, for better performance, esp. on mobile.
   * ( source: http://stackoverflow.com/questions/2854407/javascript-jquery-window-resize-how-to-fire-after-the-resize-is-completed )
   */

  footerOffsetY = 0;


  /*
  JQUERY CAPCEL
   */

  (function($) {

    /*
    resizeやscrollを指定時間経過後に１回だけ実行する
     */
    var $HH, $SM, $SMW, $ocL, $pf, $sbm, loadGravatars, removeOuterCallback;
    $.extend({
      waitForFinalEvent2: (function() {
        var timers;
        timers = {};
        return function(callback, ms, uniqueId) {
          if (!uniqueId) {
            uniqueId = "Don't call this twice without a uniqueId";
          }
          if (timers[uniqueId]) {
            clearTimeout(timers[uniqueId]);
          }
          timers[uniqueId] = setTimeout(callback, ms);
        };
      })(),
      getFooterOffsetY: function() {
        footerOffsetY = $(document).height() - $(".footer").outerHeight(true);
      }
    });

    /*
     * We're going to swap out the gravatars.
     * In the functions.php file, you can see we're not loading the gravatar
     * images on mobile to save bandwidth. Once we hit an acceptable viewport
     * then we can swap out those images since they are located in a data attribute.
     */
    loadGravatars = function() {
      viewport = updateViewportDimensions();
      if (viewport.width >= 768) {
        return $('.comment img[data-gravatar]').each(function() {
          return $(this).attr('src', $(this).attr('data-gravatar'));
        });
      }
    };

    /*
    outer click
     */
    removeOuterCallback = function(obj) {
      obj.removeClass("outer");
    };
    $ocL = $("#outerClickLayer");
    $ocL.on('click', function() {
      var $closeObj, e;
      $(this).hide();
      $closeObj = $(".outer");
      e = $(this).data('effect');
      switch (e) {
        case "slideSide":
          $closeObj.stop().animate({
            'right': "-" + $SMW
          }, function() {
            $closeObj.hide();
            removeOuterCallback($closeObj);
          });
          break;
        default:
          $closeObj.stop().slideUp(removeOuterCallback($closeObj));
      }
    });
    $.fn.showOuterClickLayer = function(opt) {
      var effect;
      $ocL.css('height', $("#container").outerHeight(true)).show();
      effect = opt != null ? opt : "slideUp";
      $ocL.data('effect', effect);
      $(this).addClass("outer");
      $(window).on('touchmove.noScroll', function(e) {});
    };

    /*
    jQuery image is loaded check
     */
    $.fn.isLoaded = function() {
      return this.filter("img").filter(function() {
        return this.complete;
      }).length > 0;
    };
    $sbm = $(".sbm-container");
    $pf = $('#product-footer-nav');
    $HH = $('.home .header');
    $SM = $("#side-menu");
    $SMW = "";

    /*
     * Put all your regular jQuery in here.
     */
    $(function() {

      /*
       * Let's fire off the gravatar function
       * You can remove this if you don't need it
       */
      var $cal, $closeHTML, $gallery, activateSubMenu, closeMenuPanel, deactivateSubMenu, desktopToolsControl, floatingSBM, initBasedOnScreen, scriptsForDesktop, scriptsForMobile, showSideMenuTrigger, timerId;
      loadGravatars();

      /*
      HOME CALENDAR
       */
      $cal = $('.home .business-calendar-box').children('div');
      if ($cal.length === 2) {
        $cal.last().hide();
        $('.changeMonth-item').on('click', function() {
          $('.changeMonth-item').each(function() {
            return $(this).toggleClass('hide');
          });
          $cal.each(function() {
            return $(this).stop().toggle();
          });
        });
      }

      /*
      SMOOTH SCROLL
       */
      $('a:empty').css({
        display: 'block'
      });
      $('.smooth a[href^=#]').on('click', function() {
        var href, position, speed, target;
        speed = 400;
        href = $(this).attr("href");
        target = $(this.hash);
        position = target.offset().top - 60;
        $("html,body").animate({
          scrollTop: position
        }, speed, 'swing');
        return false;
      });

      /*
      SCROLL FINISHED BIND
       */
      timerId = 0;
      floatingSBM = function(s) {
        var $_to, d, y;
        $.getFooterOffsetY();
        y = window.innerHeight ? window.innerHeight : $(window).outerHeight(true);
        y = s + y - footerOffsetY;
        d = 10;
        $_to = y < 0 ? d : d + y;
        $sbm.css('bottom', $_to + "px");
        $sbm.fadeIn();
      };

      /*
      HEADER CONTROL
       */
      showSideMenuTrigger = function() {
        var $y;
        $y = $('.header').outerHeight() + 10;
        $('#side-menu-trigger').css("top", $y).fadeIn();
      };
      desktopToolsControl = function(s) {
        var $n;
        if (s < 0) {
          s = $(document).scrollTop();
        }
        if ($HH.length) {
          $n = $('.head-nav');
          $('.head-branding').animate({
            'height': s > 10 ? 80 : 300
          }, function() {
            showSideMenuTrigger();
          });
          if ($('.frontPage-nav').offset().top - $('.header').outerHeight() < s) {
            if (!$n.hasClass("bond")) {
              $n.fadeIn('fast', function() {
                $n.addClass("bond");
              });
            }
          } else {
            if ($n.hasClass("bond")) {
              $n.fadeOut('fast', function() {
                $n.removeClass("bond");
              });
            }
          }
        } else {
          showSideMenuTrigger();
        }
        floatingSBM(s);
      };

      /*
      SHOW IMG EXPRAIN
       */
      $('.overLayer').on({
        'mouseenter': function() {
          $(this).find('.overLayer-target').stop().animate({
            "top": "0%"
          }, 'fast');
        },
        'mouseleave': function() {
          $(this).find('.overLayer-target').stop().animate({
            "top": "100%"
          }, 'fast');
        }
      }, "a");

      /*
      READ MORE
       */
      $('.readMore').each(function() {
        var str;
        $(this).css('position', 'relative');
        str = $(this).find('p').first().html();
        str = str.substr(0, 8) + "...";
        $(this).find('p').css({
          'position': 'relative',
          'top': '-21px'
        }).hide();
        $(this).prepend($('<a href="javascript:void(0)">').addClass('trigger-readMore').css({
          'position': 'relative'
        }).html(str));
      });
      $('.readMore').on('click', '.trigger-readMore', function() {
        $(this).fadeOut(function() {
          $(this).nextAll('p').css({
            'position': 'static',
            'top': 0
          });
        });
        $(this).nextAll('p').each(function() {
          $(this).slideDown();
        });
      });
      $(window).on('scrollFinish', function(event, scrollTop) {});
      $(window).on('scroll', function() {
        var scrollTop;
        scrollTop = $(document).scrollTop();
        $pf.stop().hide();
        if (timerId) {
          clearTimeout(timerId);
        }
        timerId = setTimeout(function() {
          timerId = null;
          return $(window).trigger("scrollFinish", [scrollTop]);
        }, 500);
      });
      $(window).unload(function() {
        $(window).unbind("scroll scrollFinish");
      });

      /*
      MAGIC POPUP
       */
      $closeHTML = '<button title="%title%" class="mfp-close"><i class="fa fa-close"></i>';
      $('.form-ajax-popup').magnificPopup({
        type: 'ajax',
        closeMarkup: $closeHTML,
        closeBtnInside: false,
        fixedContentPos: true,
        callbacks: {
          ajaxContentAdded: function() {
            var $form;
            $('.mfp-container div.wpcf7 > form').wpcf7InitForm();
            $form = $(this.content);
            $form.find(".privacypolicy-container").perfectScrollbar({
              suppressScrollX: true
            });
          }
        }
      });
      $('.gallery').magnificPopup({
        delegate: "a",
        type: "image",
        closeOnContentClick: false,
        closeMarkup: $closeHTML,
        closeBtnInside: false,
        mainClass: "mfp-with-zoom mfp-img-mobile",
        image: {
          verticalFit: true,
          titleSrc: function(item) {
            var title;
            title = (item.el.attr('title') != null) ? item.el.attr('title') : item.el.parent("dt").next("dd").text();
            return title + '&middot; <a class="image-source-link" href="' + item.el.attr('href') + '" target="_blank">image source</a>';
          }
        },
        gallery: {
          enabled: true
        },
        zoom: {
          enabled: true,
          duration: 300,
          opener: function(element) {
            return element.find('img');
          }
        }
      });

      /*
      CAROUSEL
       */
      $(".owl-carousel").owlCarousel({
        items: 1,
        itemsDesktop: [1029, 1],
        itemsDesktopSmall: false,
        itemsTablet: [768, 1],
        itemsMobile: [479, 1],
        autoPlay: true,
        afterInit: function() {}
      });
      activateSubMenu = function(r) {
        var $parent, $r, c, id, o_anchor, o_figure, o_img, o_target;
        c = "nav-itemOutline";
        $r = $(r);
        id = $r.attr('id');
        o_anchor = $r.children('a.subItem');
        if (o_anchor.length) {
          o_img = "/wp-content/themes/azis/library/images/" + id + ".jpg";
          if (!$r.children('.' + c).length && o_anchor.length > 0) {
            $r.append($("<div>").addClass(c));
          }
          o_target = $r.children('.' + c);
          if (!$r.children(c).html()) {
            if (o_target.children('a').length === 0) {
              o_target.append('<a href="' + o_anchor.attr('href') + '" style="background-image: url(' + o_img + ');"> <p>' + o_anchor.attr('title') + '</p></a>');
            }
          }
          $parent = $r.parent();
          o_target.css({
            top: 0,
            left: $parent.outerWidth(),
            height: $parent.outerHeight()
          });
          if (($("<img/>").attr('src', o_img).isLoaded)) {
            o_target.hide().stop().fadeIn('fast');
          } else {
            o_figure = o_target.children('figure');
            o_figure.addClass("loading");
            $('<img/>').load(o_img, function(response, status, xhr) {
              if (status !== "error") {
                $(this).remove();
                o_figure.removeClass("loading");
              } else {
                o_target.html('<a href="javascript:void(0)"><p>エラー。再度お試しください。</p></a>');
              }
            });
          }
        }
        o_anchor.addClass("aimHover");
      };
      deactivateSubMenu = function(r) {
        $(r).children(".nav-itemOutline").hide();
        $(r).children("a.subItem").removeClass("aimHover");
      };

      /*
      SIDEMENU
       */
      $("#side-menu-trigger").on('click', function() {
        $SM.css({
          'width': $SMW,
          'right': "-" + $SMW
        }).show().stop().animate({
          'right': 0
        }, function() {
          var h;
          h = $(window).innerHeight() ? $(window).innerHeight() : $(window).height;
          h -= $(".sideMenu-buttons").outerHeight(true) + 50;
          if (h < $('.side-menu-body').outerHeight(true)) {
            $('.side-menu-body').css('height', h).perfectScrollbar({
              suppressScrollX: true
            });
          }
        });
        $SM.showOuterClickLayer("slideSide");
      });
      closeMenuPanel = function() {
        $SM.animate({
          'right': "-" + $SMW
        });
        $ocL.hide();
      };
      $SM.on('swiperight', closeMenuPanel);
      $("#sideMenu-close").on('tap click', closeMenuPanel);
      $("#sideMenu-searchform-trigger").on('tap click', function() {
        $("#side-searchform").stop().slideToggle('fast', function() {
          $("#sideMenu-searchform-trigger").toggleClass('hover');
        });
      });

      /*
        header menu bind for desktop
       */
      scriptsForDesktop = function() {
        desktopToolsControl(-1);
        $(window).on('scrollFinish.desktopScrollFinish', function(event, scrollTop) {
          desktopToolsControl(scrollTop);
        });

        /*
        SOCIAL BOOKMARK COUNTER
         */
        $(".sbm-body").on({
          'mouseenter': function() {
            $(this).next('.sbm-count').stop().fadeIn();
          },
          'mouseleave': function() {
            $(this).next('.sbm-count').stop().fadeOut();
          }
        }, "a");
        $(window).on('scroll.sideMenuTrigger', function() {
          $('#side-menu-trigger').fadeOut();
          return $sbm.stop().hide();
        });
      };
      scriptsForMobile = function() {
        $('#side-menu-trigger').css("top", "1.5rem").show();
      };

      /*
      GET WINDOW SIZE
       */
      initBasedOnScreen = function() {
        $(window).off(".desktopScrollFinish .sideMenuTrigger");
        $(".sbm-body").off();
        $('.head-branding,.head-nav,.sbm-container,.sbm-count,#side-menu-trigger,.side-menu-body').removeAttr('style');
        $.getFooterOffsetY();
        if (Modernizr.mq('(min-width: 768px)')) {
          $SMW = "400px";
          scriptsForDesktop();
        } else {
          $SMW = "80%";
          scriptsForMobile();
        }
      };
      initBasedOnScreen();

      /*
      GALLERY POSITIVE ALPHA
       */
      $gallery = $('.img-group,.gallery');
      $gallery.on({
        'mouseover': function() {
          $(this).parents(".img-group,.gallery").find("img").not(this).stop().fadeTo(300, 0.5);
        },
        'mouseleave': function() {
          $gallery.find("img").not(this).stop().fadeTo(300, 1);
        }
      }, 'img');

      /*
      PERFECT SCROLLBAR to PRIVACY POLICY
       */
      $(".privacypolicy-container").perfectScrollbar({
        suppressScrollX: true
      });
      $(".psb").perfectScrollbar;
      $(window).resize(function() {
        $.waitForFinalEvent2(initBasedOnScreen, 100);
        $.getFooterOffsetY();
      });
    });

    /*
    WINDOW ON LOAD EVENT
     */
    $(window).load(function() {
      $.getFooterOffsetY();
    });
  })(jQuery);

}).call(this);

//# sourceMappingURL=scripts-common.js.map
